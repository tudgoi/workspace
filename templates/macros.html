{% macro ext_link(key, value) %}
    {% if key == "wikidata" %}
        {{- "https://www.wikidata.org/wiki/" ~ value -}}
    {% elif key == "wikipedia" %}
        {{- "https://en.wikipedia.org/wiki/" ~ value -}}
    {% endif %}
{% endmacro ext_link %}

{% macro render_ext_links(links) %}
{% if links %}
    <span class="ext-links">
    {% for key, value in links %}
        {% if value %}
            {% set link = macros::ext_link(key=key, value=value) %}
            {% if link | trim | length > 0 %}
                <a href="{{ macros::ext_link(key=key, value=value) }}"><button><span class="icon">{{ config.icons[key] | safe }}</span></button></a>
            {% endif %}
        {% endif %}
    {% endfor %}
    </span>
{% endif %}
{% endmacro render_ext_links %}

{% macro render_contact(key, value) %}
    {% if key == "address" %}
        {{ value }}
    {% elif key == "phone" %}
        {% for item in value %}
            <a href="tel:{{ item }}">{{ item }}</a><br>
        {% endfor %}
    {% elif key == "email" %}
        <a href="mailto:{{ value }}">{{ value }}</a>
    {% elif key == "website" %}
        {{ macros::render_url(url=value) }}
    {% elif key == "x" %}
        <a href="https://x.com/{{ value }}">@{{ value }}</a>
    {% elif key == "facebook" %}
        <a href="https://www.facebook.com/{{ value }}">{{ value }}</a>
    {% elif key == "instagram" %}
        <a href="https://www.instagram.com/{{ value }}">{{ value }}</a>
    {% elif key == "youtube" %}
        <a href="https://www.youtube.com/{{ value }}">{{ value }}</a>
    {% endif %}
{% endmacro render_contact %}

{% macro render_contacts(contacts) %}
    <dl class="contact-list">
      {% for key, value in contacts %}
        {% if value %}
            {% set link = macros::render_contact(key=key, value=value) %}
            {% if link | trim | length > 0 %}
                <div class="dl-single-line">
                  <dt><span class="icon">{{ config.icons[key] | safe }}</span></dt>
                  <dd>{{ link | safe }}</dd>
                </div>
            {% endif %}
        {% endif %}
      {% endfor %}
    </dl>
{% endmacro render_contacts %}

{% macro render_supervisors(officers) %}
    <dl>
      {% for key, value in officers %}
        {% if value %}
          {% set label = config.labels.supervisors[key] %}
          <div class="dl-single-line">
              <dt>{{ label }} </dt>
              <dd>{{ macros::render_officer(officer=value) }}</dd>
          </div>
        {% endif %}
      {% endfor %}
    </dl>
{% endmacro render_supervisors %}

{% macro render_subordinates(officers) %}
  <dl class="backlink-list">
    {% for key, value in officers %}
      {% if value %}
      {% set label = config.labels.subordinates[key] %}
        <dt>{{ label }} ({{ value | length }})</dt>
        <dd>
          <ul>
            {% for item in value %}
              <li>{{ macros::render_officer(officer=item) }}</li>
            {% endfor %}
          </ul>
        </dd>
      {% endif %}
    {% endfor %}
  </dl>
{% endmacro render_subordinates %}

{% macro render_url(url) %}
    <a href="{{ url}}">{{ url }}</a>
{% endmacro render_url %}

{% macro render_officer(officer) %}
    {% if officer.person %}
        {{- macros::render_person(person=officer.person) -}},
    {% endif %}
    {{ macros::render_office(id=officer.office_id, name=officer.office_name) }}
{% endmacro render_officer %}

{%- macro render_person(person) -%}
    <a href="{{ macros::page_link_id(type='person', id=person.id) }}">{{ person.name }}</a>
{%- endmacro render_person -%}

{%- macro render_office(id, name) -%}
    <a href="{{ macros::page_link_id(type='office', id=id) }}">{{ name }}</a>
{%- endmacro render_office -%}

{% macro render_photo(photo, alt) %}
    {%
        if photo.url is starting_with("https://upload.wikimedia.org/wikipedia/commons/")
            and not photo.url is containing("/thumb/")
            and not photo.url is ending_with(".svg")
    %}
        {% set thumbnail_url_prefix = (photo.url | replace(from="/commons/", to="/commons/thumb/")) %}
        {% set url_filename = photo.url | trim_start_matches(pat="https://upload.wikimedia.org/wikipedia/commons/") | split(pat="") | slice(start=6) | join(sep="") %}
        {% set url = thumbnail_url_prefix ~ "/320px-" ~ url_filename %}
        
    {% else %}
        {% set url = photo.url %}
    {% endif %}
    {% set attribution = photo.attribution %}
    <figure>
            <img src="{{ url }}" alt="{{ alt }}" />
        {% if attribution %}
            <figcaption title="{{ attribution }}">
                Image by {{ attribution }}
            </figcaption>
        {% endif %}
    </figure>
{% endmacro photo %}

{% macro page_link_id(type, id) %}
    {{- page.base ~ type ~ "/" ~ id ~ ".html" -}}
{% endmacro page_link_id %}
